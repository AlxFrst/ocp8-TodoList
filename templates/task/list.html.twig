{% extends 'base.html.twig' %}

{% block header_title %}
	<h1 class="mb-4">Liste des tâches</h1>
{% endblock %}

{% block body %}
	<div class="mb-4 d-flex justify-content-between align-items-center">
		<div>
			<a href="{{ path('task_create') }}" class="btn btn-action me-2">
				<i class="fas fa-plus-circle me-2"></i>Créer une tâche
			</a>
			<a href="{{ path('task_list') }}" class="btn btn-action me-2">
				<i class="fas fa-list me-2"></i>Tâches en cours
			</a>
			<a href="{{ path('task_done') }}" class="btn btn-action">
				<i class="fas fa-check-circle me-2"></i>Tâches terminées
			</a>
		</div>
	</div>

	<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
		{% for task in tasks %}
			<div class="col">
				<div class="card h-100 shadow-sm">
					<div class="card-body">
						<h5 class="card-title">
							<i class="fas fa-tasks me-2"></i>
							{{ task.title }}
						</h5>
						<p class="card-text">{{ task.content }}</p>
						{% if task.deadline %}
							<p class="card-text">
								<small class="text-muted">
									<i class="far fa-calendar-alt me-2"></i>Date limite :
									<strong>{{ task.deadline|date('d/m/Y') }}</strong>
								</small>
							</p>
						{% endif %}
						<p class="card-text">
							<small class="text-muted">
								<i class="far fa-user me-2"></i>Créé par :
								{% if task.user %}
									{{ task.user.username }}
									<br>
									<strong>Rôle :</strong>
									{% for role in task.user.roles %}
										{% if role == 'ROLE_ADMIN' %}
											<span class="badge bg-danger">Admin</span>
										{% elseif role == 'ROLE_USER' %}
											<span class="badge bg-primary">Utilisateur</span>
										{% elseif role == 'ROLE_ANONYMOUS' %}
											<span class="badge bg-secondary">Anonyme</span>
										{% endif %}
									{% endfor %}
								{% else %}
									Anonyme
								{% endif %}
							</small>
						</p>
						<p class="card-text">
							{% if task.isDone %}
								<span class="badge bg-success">
									<i class="fas fa-check me-2"></i>Terminée</span>
							{% else %}
								<span class="badge bg-warning text-dark">
									<i class="fas fa-hourglass-half me-2"></i>En cours</span>
							{% endif %}
						</p>
					</div>
					<div class="card-footer bg-transparent border-top-0">
						<div class="d-flex justify-content-between">
							<form action="{{ path('task_toggle', {'id' : task.id }) }}" method="post">
								<button class="btn btn-sm btn-action">
									<i class="fas fa-{{ task.isDone ? 'undo' : 'check' }} me-2"></i>
									{% if not task.isDone %}Marquer comme faite{% else %}Marquer non terminée
									{% endif %}
								</button>
							</form>
							<div>
								{% if is_granted('task_edit', task) %}
<a href="{{ path('task_edit', {'id' : task.id }) }}" class="btn btn-action me-2">
	<i class="fas fa-edit me-2"></i>Éditer
</a>

								{% endif %}
								{% if is_granted("task_delete", task) %}
									<form action="{{ path('task_delete', {'id' : task.id }) }}" method="post" class="d-inline">
										<button class="btn btn-sm btn-action">
											<i class="fas fa-trash-alt me-2"></i>Supprimer
										</button>
									</form>
								{% endif %}
							</div>
						</div>
					</div>
				</div>
			</div>
		{% else %}
			<div class="col-12">
				<div class="alert alert-warning" role="alert">
					<i class="fas fa-exclamation-triangle me-2"></i>
					Il n'y a pas encore de tâche enregistrée.
					<a href="{{ path('task_create') }}" class="btn btn-action ms-3">
						<i class="fas fa-plus-circle me-2"></i>Créer une tâche
					</a>
				</div>
			</div>
		{% endfor %}
	</div>
{% endblock %}
